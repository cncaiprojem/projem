# Enterprise Alembic Configuration for PostgreSQL 17.6
# FreeCAD CNC/CAM/CAD Production Platform
# Security: Do not commit database credentials to version control

[alembic]
# Script location for migrations
script_location = alembic

# Database URL (overridden by environment variable)
sqlalchemy.url = 

# PostgreSQL 17.6 specific configuration
# Timezone handling: All timestamps in UTC with timezone awareness
timezone = UTC

# Output to file for production audit trail
# file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s

# Version path pattern for organized migrations
# version_path_separator = os
version_path_separator = os

# Truncate slug for cleaner filenames
truncate_slug_length = 40

# Compare type to detect column type changes
compare_type = true

# Compare server defaults to detect changes
compare_server_default = true

# Render schema changes with appropriate batching
render_as_batch = false

# PostgreSQL-specific settings for enterprise environments
[postgresql]
# Connection pool settings for production workloads
pool_size = 20
max_overflow = 30
pool_timeout = 30
pool_recycle = 3600

# Statement timeout for long-running migrations (30 minutes)
statement_timeout = 1800000

# Lock timeout to prevent indefinite waits (5 minutes)  
lock_timeout = 300000

# Checkpoint segments for large migrations
checkpoint_segments = 32

# WAL settings for performance during migrations
wal_buffers = 16MB
shared_buffers = 256MB

[logging]
# Enterprise logging configuration
keys = root,sqlalchemy,alembic

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console,file

[formatters]
keys = generic,detailed

[logger_root]
level = INFO
handlers = console
qualname = 

[logger_sqlalchemy]
level = WARN
handlers = console
qualname = sqlalchemy.engine
# Set to INFO for debugging slow queries during migrations
# level = INFO

[logger_alembic]
level = INFO
handlers = console,file
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[handler_file]
class = FileHandler
args = ('alembic.log',)
level = INFO
formatter = detailed

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

[formatter_detailed]
format = %(asctime)s %(levelname)-5.5s [%(name)s:%(lineno)d] %(message)s
datefmt = %Y-%m-%d %H:%M:%S


